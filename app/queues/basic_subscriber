require 'bunny'
module BasicSubscriber
  def self.direct_exchange(exchange_name, queue_name)
    connection = Bunny.new
    connection.start
    channel = connection.create_channel
    sleep 5
    queue = channel.queue(queue_name, exclusive: true)
    ex = channel.direct("#{exchange_name}", durable: true)
    queue.bind(exchange_name)
    result = []
    queue.subscribe { |_delivery_info, _properties, message|  result << message }

    connection.close
    connection = nil
    channel = nil
    result[0]
  end
end
